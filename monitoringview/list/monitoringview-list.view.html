<div class="wrapper message-monitoringview-manager">

  <div movable-dialog title="'Filter'" ng-model="ctrl.filterPosition">
    <div class="filter-dialog">
      <form>
        <div class="input-group">
          <span class="input-group-addon" id="filter-fulltext"><i class="fa fa-font"></i></span>
          <input type="text" class="form-control" placeholder="text" ng-model="ctrl.tmpFilter.filterText" aria-describedby="filter-fulltext">
        </div>
        <div class="form-group">
          <input type="text" class="form-control" placeholder="open,doing" ng-model="ctrl.tmpFilter.filterInLabel" aria-describedby="filter-labels">
          <span id="helpBlock" class="help-block">
            in <i class="fa fa-tags"></i> : Contains one or many labels of this list
          </span>
        </div>

        <div class="form-group">
          <input type="text" class="form-control" placeholder="open,doing" ng-model="ctrl.tmpFilter.filterAndLabel" aria-describedby="filter-labels">
          <span id="helpBlock" class="help-block">
            all <i class="fa fa-tags"></i> : Contains all labels in this list
          </span>
        </div>

        <div class="form-group">
          <input type="text" class="form-control" placeholder="done" ng-model="ctrl.tmpFilter.filterNotLabel" aria-describedby="filter-hide-labels">
          <span id="helpBlock" class="help-block">
            hide <i class="fa fa-tags"></i> : Hide all labels in this list
          </span>
        </div>

        <div class="form-group">
          <input type="text" class="form-control" placeholder="PCC,STOCKAGE" ng-model="ctrl.tmpFilter.filterInTag" aria-describedby="filter-tags">
          <span id="helpBlock" class="help-block">
            in <i class="glyphicon glyphicon-copyright-mark"></i> : Contains one or many tags of this list
          </span>
        </div>

        <div class="form-group">
          <input type="text" class="form-control" placeholder="PCC,STOCKAGE" ng-model="ctrl.tmpFilter.filterAndTag" aria-describedby="filter-tags">
          <span id="helpBlock" class="help-block">
            all <i class="glyphicon glyphicon-copyright-mark"></i> : Contains all tags in this list
          </span>
        </div>

        <div class="form-group">
          <input type="text" class="form-control" placeholder="PCC,STOCKAGE" ng-model="ctrl.tmpFilter.filterNotTag" aria-describedby="filter-hide-tags">
          <span id="helpBlock" class="help-block">
            hide <i class="glyphicon glyphicon-copyright-mark"></i> : Hide all tags in this list
          </span>
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary btn-xs" ng-click="ctrl.filterSearch()">Search</button>
        </div>
      </form>
    </div>
  </div>

  <div class="row">
      <div class="btn-group">
         <button class="btn btn-default" data-ng-click="ctrl.filterPosition.visible = true"><i class="fa fa-filter"></i></button>
         <button class="btn btn-default" data-ng-click="ctrl.tmpFilter.filterAndLabel = ''; ctrl.filterSearch()">{{ctrl.data.messages.length}} ALL</button>
         <button class="btn btn-danger" data-ng-click="ctrl.tmpFilter.filterAndLabel = 'AL'; ctrl.filterSearch()">{{ctrl.data.nbAL}} AL</button>
         <button class="btn btn-success" data-ng-click="ctrl.tmpFilter.filterAndLabel = 'UP'; ctrl.filterSearch()">{{ctrl.data.nbUP}} UP</button>
         <button class="btn btn-warning" data-ng-click="ctrl.tmpFilter.filterAndLabel = ''; ctrl.filterSearch()">{{ctrl.data.nbOther}} Other(s)</button>
       </div>

      <span class="message-filters">
        <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.text"><i class="fa fa-font"></i> {{ctrl.filter.text}}
            <a role="button" ng-click="ctrl.tmpFilter.filterText = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
        </span>
        <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.label">in <i class="fa fa-tags"></i> : {{ctrl.filter.label}}
            <a role="button" ng-click="ctrl.tmpFilter.filterInLabel = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
        </span>
        <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.andLabel">all <i class="fa fa-tags"></i> : {{ctrl.filter.andLabel}}
            <a role="button" ng-click="ctrl.tmpFilter.filterAndLabel = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
        </span>
        <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.notLabel">hide <i class="fa fa-tags"></i> : {{ctrl.filter.notLabel}}
            <a role="button" ng-click="ctrl.tmpFilter.filterNotLabel = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
        </span>
        <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.tag">in <i class="glyphicon glyphicon-copyright-mark"></i> {{ctrl.filter.tag}}
            <a role="button" ng-click="ctrl.tmpFilter.filterInTag = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
        </span>
        <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.andTag">all <i class="glyphicon glyphicon-copyright-mark"></i> : {{ctrl.filter.andTag}}
            <a role="button" ng-click="ctrl.tmpFilter.filterAndTag = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
        </span>
        <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.notTag">hide <i class="glyphicon glyphicon-copyright-mark"></i> : {{ctrl.filter.notTag}}
            <a role="button" ng-click="ctrl.tmpFilter.filterNoTag = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
        </span>
        <span class="badge" data-ng-if="ctrl.filter.idMessage"> <i class="fa fa-envelope"></i> message : {{ctrl.filter.idMessage}}
            <a role="button" ng-click="ctrl.tmpFilter.idMessage = '-1'; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
        </span>
      </span>
  </div>
  <uib-progress><uib-bar ng-repeat="bar in ctrl.data.stacked track by $index" value="bar.value" type="{{bar.type}}"><span>{{bar.value}}%</span></uib-bar></uib-progress>

  <div class="row">
    <div class="col-md-12">
      <span>Last 10 update:</span>
      <span style="color:#ffffff;cursor:pointer"
        data-ng-click="ctrl.toggleMessage(msg)"
        ng-repeat="msg in ctrl.data.messages | limitTo:10" class="btn btn-xs {{msg.statusCss}}">
        {{ctrl.getItem(msg)}}
      </span>
    </div>
  </div>

  <div class="row">
    <div data-ng-class="message ? 'message-monitoringview-list col-md-7': 'message-monitoringview-list col-md-12'">
      <div class="hex-row">
        <div class="hex" uib-popover="{{ctrl.getItem(msg)}}" popover-trigger="mouseenter" popover-placement="bottom"
          style="color:#ffffff;cursor:pointer"
          data-ng-click="ctrl.toggleMessage(msg)"
          ng-repeat="msg in ctrl.data.messages" ng-show="!msg.hide">
          <div class="top {{msg.statusText}}"></div>
          <div class="middle {{msg.statusText}}"></div>
          <div class="bottom {{msg.statusText}}"></div>
        </div>
      </div>
    </div>

    <div class="col-md-5" ng-if="message">
      <div class="monitoringview-message-right">
        <button class="btn btn-default btn-xs pull-right" data-ng-click="ctrl.closeMessage()">X</button>
        <messages-monitoringview-item
               data-topic="ctrl.topic"
               data-message="message"
               data-is-topic-bookmarks="ctrl.isTopicBookmarks"
               data-is-topic-tasks="ctrl.isTopicTasks"
               data-is-topic-deletable-msg="ctrl.data.isTopicDeletableMsg"
               data-is-topic-updatable-msg="ctrl.data.isTopicUpdatableMsg"
               data-is-topic-deletable-all-msg="ctrl.data.isTopicDeletableAllMsg"
               data-is-topic-updatable-all-msg="ctrl.data.isTopicUpdatableAllMsg"
               data-is-topic-rw="ctrl.isTopicRw"></messages-monitoringview-item>
      </div>
    </div>
  </div>

  <div class="row">
    <button data-ng-disabled="!ctrl.data.displayMore" data-ng-click="ctrl.loadMore()" class="btn btn-default">
      <span data-ng-show="!ctrl.data.displayMore">No</span> More
    </button>
  </div>
</div>
